<!doctype html><html lang=en class=no-js> <head><link rel=stylesheet href=assets/javascripts/main.bec4e691.min.css><link rel=stylesheet href=assets/javascripts/palette.96b5c56e.min.css><link rel=stylesheet href=assets/javascripts/main.9e77ca7e.min.css><link rel=stylesheet href=assets/javascripts/home.def3a648.min.css><link rel=stylesheet href=assets/javascripts/css><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Yichu Yang"><link href=https://yichuyang.com/blog/Sensor-Fusion/ESKF%E5%8A%A8%E5%8A%9B%E5%AD%A6%E6%96%B9%E7%A8%8B/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.2.13"><title>ESKF动力学方程 - Yichu's blog</title><link rel=stylesheet href=../../assets/stylesheets/main.e411adfe.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cc9b2e1e.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#1-eskf class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Yichu's blog" class="md-header__button md-logo" aria-label="Yichu's blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Yichu's blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ESKF动力学方程 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=white data-md-color-accent=cyan aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../LOAM/ class="md-tabs__link md-tabs__link--active"> Sensor Fusion </a> </li> <li class=md-tabs__item> <a href=../../Motion-Planning/BCH-approximation/ class=md-tabs__link> Motion Planning </a> </li> <li class=md-tabs__item> <a href=../../MPC/%E5%9F%BA%E4%BA%8E%E9%98%B6%E8%B7%83%E5%93%8D%E5%BA%94%E7%9A%84%E6%97%A0%E7%BA%A6%E6%9D%9F%E6%8E%A7%E5%88%B6/ class=md-tabs__link> MPC </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Yichu's blog" class="md-nav__button md-logo" aria-label="Yichu's blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> Yichu's blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Sensor Fusion <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Sensor Fusion" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Sensor Fusion </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../LOAM/ class=md-nav__link> LOAM </a> </li> <li class=md-nav__item> <a href=../Ceres-Tutorial/ class=md-nav__link> Ceres 使用入门 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 data-md-state=indeterminate type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3> 惯性导航 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=惯性导航 data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 惯性导航 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../%E5%9B%9B%E5%85%83%E6%95%B0%E5%9F%BA%E7%A1%80%E5%92%8C%E6%83%AF%E6%80%A7%E5%AF%BC%E8%88%AA%E8%A7%A3%E7%AE%97/ class=md-nav__link> 四元数基础和惯性导航解算 </a> </li> <li class=md-nav__item> <a href=../%E6%83%AF%E6%80%A7%E5%AF%BC%E8%88%AA%E5%8E%9F%E7%90%86%E5%8F%8A%E8%AF%AF%E5%B7%AE%E5%88%86%E6%9E%90/ class=md-nav__link> 惯性导航原理及误差分析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 data-md-state=indeterminate type=checkbox id=__nav_2_4 checked> <label class=md-nav__link for=__nav_2_4> 卡尔曼滤波 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=卡尔曼滤波 data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 卡尔曼滤波 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/ class=md-nav__link> 卡尔曼滤波 </a> </li> <li class=md-nav__item> <a href=../%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E6%8E%A8%E5%AF%BC/ class=md-nav__link> 卡尔曼滤波推导 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_5 type=checkbox id=__nav_2_5 checked> <label class=md-nav__link for=__nav_2_5> 误差状态卡尔曼(ESKF)笔记 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=误差状态卡尔曼(ESKF)笔记 data-md-level=2> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 误差状态卡尔曼(ESKF)笔记 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> ESKF动力学方程 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> ESKF动力学方程 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-eskf class=md-nav__link> 1. ESKF 简介 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 真值状态动力学方程 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3.名义状态动力学方程 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4.误差状态动力学方程 </a> <nav class=md-nav aria-label=4.误差状态动力学方程> <ul class=md-nav__list> <li class=md-nav__item> <a href=#linear-velocity-error class=md-nav__link> 速度误差(Linear velocity error) 动力学推导: </a> </li> <li class=md-nav__item> <a href=#orientation-error class=md-nav__link> 方向误差(orientation error) 动力学推导: </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ESKF%E7%A6%BB%E6%95%A3%E5%8A%A8%E5%8A%9B%E5%AD%A6%E6%96%B9%E7%A8%8B/ class=md-nav__link> ESKF离散动力学方程 </a> </li> <li class=md-nav__item> <a href=../ESKF%E8%AF%AF%E5%B7%AE%E7%8A%B6%E6%80%81%E6%BB%A4%E6%B3%A2%E5%99%A8/ class=md-nav__link> ESKF误差状态滤波器 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 data-md-state=indeterminate type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Motion Planning <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Motion Planning" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Motion Planning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Motion-Planning/BCH-approximation/ class=md-nav__link> BCH approximation </a> </li> <li class=md-nav__item> <a href=../../Motion-Planning/ICP-realization/ class=md-nav__link> ICP realization </a> </li> <li class=md-nav__item> <a href=../../Motion-Planning/matrix_diff/ class=md-nav__link> Matrix diff </a> </li> <li class=md-nav__item> <a href=../../Motion-Planning/trajectory-optimization/ class=md-nav__link> Trajectory optimization </a> </li> <li class=md-nav__item> <a href=../../Motion-Planning/Polynomial-Trajectory-Planning-for-Aggressive-Quadrotor-Flight/ class=md-nav__link> Polynomial Trajectory Planning for Aggressive Quadrotor Flight </a> </li> <li class=md-nav__item> <a href=../../Motion-Planning/B-spline/ class=md-nav__link> B spline </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 data-md-state=indeterminate type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> MPC <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MPC data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> MPC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../MPC/%E5%9F%BA%E4%BA%8E%E9%98%B6%E8%B7%83%E5%93%8D%E5%BA%94%E7%9A%84%E6%97%A0%E7%BA%A6%E6%9D%9F%E6%8E%A7%E5%88%B6/ class=md-nav__link> 基于阶跃响应的无约束控制 </a> </li> <li class=md-nav__item> <a href=../../MPC/testpage/ class=md-nav__link> Testpage </a> </li> <li class=md-nav__item> <a href=../../MPC/testpage.html class=md-nav__link> None </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-eskf class=md-nav__link> 1. ESKF 简介 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2. 真值状态动力学方程 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3.名义状态动力学方程 </a> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4.误差状态动力学方程 </a> <nav class=md-nav aria-label=4.误差状态动力学方程> <ul class=md-nav__list> <li class=md-nav__item> <a href=#linear-velocity-error class=md-nav__link> 速度误差(Linear velocity error) 动力学推导: </a> </li> <li class=md-nav__item> <a href=#orientation-error class=md-nav__link> 方向误差(orientation error) 动力学推导: </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <nav class=md-tags> <a href=../../tags/#eskf class=md-tag> ESKF </a> </nav> <h1>ESKF动力学方程</h1> <h2 id=1-eskf>1. ESKF 简介<a class=headerlink href=#1-eskf title="Permanent link">&para;</a></h2> <p>原状态变量称为 <strong>名义状态变量</strong>（nominal state）即不考虑噪声的状态。</p> <p>真实的状态为 <strong>真值状态</strong> (true state), 需要考虑噪声。</p> <p>ESKF里的状态变量称为 <strong>误差状态变量</strong>（error state), 他们的关系为<code>误差状态变量= 真值状态-名义状态变量</code>, 误差状态变量</p> <p>ESKF predicts a Gaussian estimate of the error-state</p> <p><strong>ESKF 优点</strong>：</p> <ul> <li>error state中旋转变量可以用最小表示，即旋转向量表示，没有多余的变量，可以避免冗余变量带来的singularity risk</li> <li>error-state system 通常都在原点附近，可以避免万向节锁，奇异值等问题，保证linearization每时每刻都是可行的</li> <li>error state 通常都很小，因此二阶量可以忽略，雅可比的计算更快速</li> <li>error state dynamics比较慢，因为大信号在名义动力学中被积分了，剩下的error是小信号，因此ESKF可以工作在较低的频率下</li> </ul> <p>ESKF流程：</p> <blockquote> <p>In parallel with integration of the nominal state, the ESKF predicts a Gaussian estimate of the error-state. It only predicts, because by now no other measurement is available to correct these estimates. The filter correction is performed at the arrival of information other than IMU (e.g. GPS, vision, etc.), which is able to render the errors observable and which happens generally at a much lower rate than the integration phase. This correction provides a posterior Gaussian estimate of the error-state. After this, the error-state’s mean is injected into the nominal-state, then reset to zero. The error-state’s covariances matrix is conveniently updated to reflect this reset. The system goes on like this forever</p> </blockquote> <h2 id=2>2. 真值状态动力学方程<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p><strong>真值状态动力学方程</strong>，这些状态是在世界坐标系下的。 </p> <div class=arithmatex>\[ \begin{align} &amp;\text{Position:}&amp;\dot{p_t}&amp;=v_t\\ &amp;\text{Velocity:}&amp;\dot{v_t}&amp;=a_t=R_t(a_m-bias_{at}-\eta_a)+g_t\\ &amp;\text{Quaternion:}&amp;\dot{q_t}&amp;=\frac{1}{2}q_t \otimes \omega_t=\frac{1}{2}q_t \otimes (\omega_m-bias_{gt}-\eta_g )\\ &amp;\text{Accelerometer bias:}&amp;\dot{bias}_{at}&amp;=\eta_{ba}(noise)\\ &amp;\text{Gyrometer bias:}&amp;\dot{bias}_{gt}&amp;=\eta_{bg}(noise)\\ &amp;\text{Gravity vector:}&amp;\dot{g_t}&amp;=0\\ \end{align} \]</div> <p>其中，加速度at和角速度wt是由IMU测量值计算出来的： </p> <div class=arithmatex>\[ \begin{align} a_m&amp;=R_t^\top(a_t-g_t)+bias_a+\eta_a &amp;\Rightarrow a_t&amp;=R_t(a_m-bias_a-\eta_a)+g_t\\ \omega_m&amp;=\omega_t+bias_g+\eta_g&amp;\Rightarrow \omega_t&amp;=\omega_m-bias_g-\eta_g \end{align} \]</div> <h2 id=3>3.名义状态动力学方程<a class=headerlink href=#3 title="Permanent link">&para;</a></h2> <p><strong>名义状态动力学方程</strong>，这些状态是在世界坐标系下的。 </p> <div class=arithmatex>\[ \begin{align} &amp;\text{Position:}&amp;\dot{p}&amp;=v\\ &amp;\text{Velocity:}&amp;\dot{v}&amp;=R(a_m-bias_a)+g\\ &amp;\text{Quaternion:}&amp;\dot{q}&amp;=\frac{1}{2}q \otimes (\omega_m-bias_g)\\ &amp;\text{Accelerometer bias:}&amp;\dot{bias}_{a}&amp;=0\\ &amp;\text{Gyrometer bias:}&amp;\dot{bias}_{g}&amp;=0\\ &amp;\text{Gravity vector:}&amp;\dot{g_t}&amp;=0\\ \end{align} \]</div> <h2 id=4>4.误差状态动力学方程<a class=headerlink href=#4 title="Permanent link">&para;</a></h2> <p><strong>误差状态动力学方程</strong> (error-state kinematics) </p> <div class=arithmatex>\[ \begin{align} &amp;\text{Position:}&amp; \delta \dot{p}&amp;=\delta v\\ &amp;\text{Velocity:}&amp; \delta \dot{v}&amp;=-R[a_m-bias_a]_{times}\delta \theta -R \delta a_b +\delta g -R\eta_a\\ &amp;\text{Quaternion:}&amp; \delta \dot{\theta}&amp;=-[\omega_m-bias_g]_{\times}\delta \theta - \delta bias_g - \eta_g\\ &amp;\text{Accelerometer bias:}&amp; \delta \dot{bias}_{a}&amp;=\eta_{ba}\\ &amp;\text{Gyrometer bias:}&amp; \delta \dot{bias}_{g}&amp;=\eta_{bg}\\ &amp;\text{Gravity vector:}&amp; \delta \dot{g}&amp;=0\\ \end{align} \]</div> <h3 id=linear-velocity-error>速度误差(Linear velocity error) 动力学推导:<a class=headerlink href=#linear-velocity-error title="Permanent link">&para;</a></h3> <div class=arithmatex>\[ \begin{align} R_t&amp; = R(I+[\delta \theta]_{\times})\\ bias_{at}&amp;=bias_a+\delta bias_a\\ g_{t}&amp;=g+\delta g\\ a_B&amp; \doteq a_m-bias_a\\ \delta a_B&amp;\doteq -\delta bias_a-\eta_{ba}\\ \Rightarrow \dot{v}&amp;=R a_B +g\\ \dot{v}+\dot{\delta v}=\dot{v_t}&amp;=R_t(a_m-bias_{at}-\eta_a)+g_t\\ &amp;=R(I+[\delta \theta]_{\times})(\underbrace{a_m-bias_a}_{a_B}+\underbrace{-\delta bias_a-\eta_a}_{\delta a_B})+g_t\\ &amp;=R(I+[\delta \theta]_{\times})(a_B+\delta a_B)+g+\delta g\\ \Rightarrow \cancel{R a_B} +\cancel{g} +\dot{\delta v}=\dot{v_t}&amp;=\cancel{R a_B}+R[\delta \theta]_{\times}a_B+R\delta a_B+R[\delta \theta]_{\times}\delta a_B+\cancel{g}+\delta g\\ \Rightarrow \dot{\delta v}&amp;=R[\delta \theta]_{\times}a_B+R\delta a_B+\cancel{R[\delta \theta]_{\times}\delta a_B}(二阶小量)+\delta g\\ &amp;=-R[a_B]_{\times}\delta \theta+R\delta a_B+\delta g\\ &amp;=-R[a_m-bias_a]_{\times}\delta \theta+R(-\delta bias_a-\eta_{ba})+\delta g\\ \dot{\delta v}&amp;=-R[a_m-bias_a]_{\times}\delta \theta-R\delta bias_a+\delta g-R\eta_{ba}\\ \end{align} \]</div> <p>如果三轴加速度计是同型号的，可以假设其加速度计噪声是独立同分布且各项同性的，即其噪声的均值和协方差与旋转无关。</p> <p>即<span class=arithmatex>\(\eta_{ba}=R \eta_{ba}\)</span>，则可以进一步简化：</p> <div class=arithmatex>\[ \dot{\delta v}=-R[a_m-bias_a]_{\times}\delta \theta-R\delta bias_a+\delta g-\underline{\eta_{ba}}\\ \]</div> <h3 id=orientation-error>方向误差(orientation error) 动力学推导:<a class=headerlink href=#orientation-error title="Permanent link">&para;</a></h3> <div class=arithmatex>\[ \begin{align} (定义)q_t&amp;=q \otimes \delta q\\ \dot{q_t}&amp;=\frac{1}{2}q_t \otimes \omega_t\\ \dot{q}&amp;=\frac{1}{2}q \otimes \omega\\ bias_{gt}&amp;=bias_g+\delta bias_g\\ (定义)\omega_t &amp;= \omega + \delta \omega \\ (计算)\omega_t &amp;=\omega_m-bias_{gt}-\eta_g \\ &amp;=\underbrace{\omega_m-bias_g}_{\omega}+\underbrace{-\delta bias_g-\eta_g}_{\delta\omega}\\ \frac{1}{2}q_t \otimes \omega_t=\dot{q_t}&amp;=(\dot{q \otimes \delta q})\\ \Rightarrow\frac{1}{2}q \otimes \delta q \otimes \omega_t=\dot{q_t}&amp;=\dot{q} \otimes \delta q+q \otimes \dot{\delta q}\\ \Rightarrow\frac{1}{2} \cancel{q \otimes} \delta q \otimes \omega_t&amp;=\frac{1}{2} \cancel{q \otimes} \omega \otimes \delta q+\cancel{q \otimes} \dot{\delta q}\\ \Rightarrow 2\dot{\delta q} &amp;=\delta q \otimes \omega_t-\omega \otimes \delta q \end{align} \]</div> <div class="admonition note"> <p class=admonition-title>四元数乘法</p> <p><span class=arithmatex>\([\mathbf{p}]_L=p_w\mathbf{I}+\begin{bmatrix}0&amp;-\mathbf{p}_v^\top\\\mathbf{p}_v&amp;[\mathbf{p}_v]_{\times}\end{bmatrix}\)</span>, <span class=arithmatex>\([\mathbf{q}]_R=q_w\mathbf{I}+\begin{bmatrix}0&amp;-\mathbf{q}_v^\top\\\mathbf{q}_v&amp;-[\mathbf{q}_v]_{\times}\end{bmatrix}\)</span></p> </div> <p>将向量(纯虚四元数)的四元数乘法带入打开: </p> <div class=arithmatex>\[ \begin{align} \Rightarrow 2\dot{\delta q} &amp;=[\omega_t]_{R}\delta q -[\omega]_L\delta q\\ &amp;=\begin{bmatrix} 0&amp;-\omega_t^\top\\ \omega_t&amp;-[\omega_t]_{\times} \end{bmatrix}\delta q - \begin{bmatrix} 0&amp;-\omega^\top\\ \omega &amp; [\omega]_{\times} \end{bmatrix}\delta q\\ &amp;=\begin{bmatrix} 0&amp;-(\omega_t-\omega)^\top\\ \omega_t-\omega&amp;-[\omega_t+\omega]_{\times} \end{bmatrix}\begin{bmatrix}1 \\ \frac{1}{2}\delta\theta\end{bmatrix}\\ \Rightarrow 2\begin{bmatrix}0 \\ \frac{1}{2}\delta\dot{\theta}\end{bmatrix}&amp;=\begin{bmatrix} 0&amp;-\delta\omega^\top\\ \delta\omega &amp;-[\delta\omega+2\omega]_{\times} \end{bmatrix}\begin{bmatrix}1 \\ \frac{1}{2}\delta\theta\end{bmatrix}\\ \Rightarrow &amp; \begin{cases} 0 = -\delta\omega^\top \delta\theta(二阶小量忽略)\\ \delta\dot{\theta} = \delta\omega -[\delta\omega+2\omega]_{\times}\frac{1}{2}\delta\theta \end{cases}\\ \Rightarrow \delta\dot{\theta} &amp;= \delta\omega \cancel{-\frac{1}{2}[\delta\omega]_{\times}\delta\theta} -[\omega]_{\times}\delta\theta\\ \Rightarrow \delta\dot{\theta} &amp;= \delta\omega-[\omega]_{\times}\delta\theta\\ &amp;=-[\omega_m-bias_g]_{\times}\delta\theta-\delta bias_g-\eta_g\\ \end{align} \]</div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E6%8E%A8%E5%AF%BC/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 卡尔曼滤波推导" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 卡尔曼滤波推导 </div> </div> </a> <a href=../ESKF%E7%A6%BB%E6%95%A3%E5%8A%A8%E5%8A%9B%E5%AD%A6%E6%96%B9%E7%A8%8B/ class="md-footer__link md-footer__link--next" aria-label="Next: ESKF离散动力学方程" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> ESKF离散动力学方程 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/yangyichu target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://pypi.org/project/mkdocs-material/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "navigation.expand", "navigation.indexes", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.ed9748b7.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.0/es5/tex-chtml-full.min.js></script> </body> </html>